<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitLife 3D - AI Fitness Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: #0a0a0a; color: #fff; overflow-x: hidden; }
        #loader { position: fixed; width: 100%; height: 100vh; background: #0a0a0a; display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 1s; }
        .loader-content { text-align: center; }
        .loader-spinner { width: 60px; height: 60px; border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid #00ffcc; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        nav { position: fixed; width: 100%; padding: 20px 50px; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 1000; transition: all 0.3s; }
        nav.scrolled { padding: 15px 50px; background: rgba(0,0,0,0.95); }
        .nav-container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 28px; font-weight: bold; background: linear-gradient(45deg, #00ffcc, #0080ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-links { display: flex; list-style: none; gap: 30px; }
        .nav-links a { color: #fff; text-decoration: none; transition: color 0.3s; }
        .nav-links a:hover { color: #00ffcc; }
        #hero { height: 100vh; position: relative; overflow: hidden; }
        #canvas-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .hero-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 10; }
        .hero-title { font-size: 80px; font-weight: bold; margin-bottom: 20px; background: linear-gradient(45deg, #00ffcc, #0080ff, #ff00ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .hero-subtitle { font-size: 24px; margin-bottom: 30px; opacity: 0.8; }
        .cta-button { display: inline-block; padding: 15px 40px; background: linear-gradient(45deg, #00ffcc, #0080ff); border: none; border-radius: 50px; color: #fff; font-size: 18px; cursor: pointer; transition: all 0.3s; text-decoration: none; }
        .cta-button:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,255,204,0.3); }
        .section { padding: 100px 50px; max-width: 1200px; margin: 0 auto; position: relative; }
        .section-title { font-size: 48px; text-align: center; margin-bottom: 50px; background: linear-gradient(45deg, #ff00ff, #00ffcc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #food-scanner { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 50px; margin-bottom: 50px; }
        .scanner-container { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: center; }
        #camera-feed { width: 100%; height: 400px; background: #111; border-radius: 20px; position: relative; overflow: hidden; }
        #video { width: 100%; height: 100%; object-fit: cover; }
        .scan-button { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 30px; background: linear-gradient(45deg, #00ffcc, #0080ff); border: none; border-radius: 25px; color: #fff; font-size: 16px; cursor: pointer; transition: all 0.3s; }
        .scan-button:hover { transform: translateX(-50%) translateY(-3px); box-shadow: 0 5px 20px rgba(0,255,204,0.4); }
        .nutrition-results { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; }
        .nutrient-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .nutrient-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .nutrient-fill { height: 100%; background: linear-gradient(90deg, #00ffcc, #0080ff); transition: width 1s ease; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 40px; }
        .stat-card { background: rgba(255,255,255,0.05); padding: 30px; border-radius: 20px; position: relative; overflow: hidden; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, #00ffcc, #ff00ff); }
        .stat-value { font-size: 36px; font-weight: bold; margin: 10px 0; }
        .workout-planner { background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; margin-top: 40px; }
        .day-selector { display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        .day-btn { padding: 10px 20px; background: rgba(255,255,255,0.1); border: 1px solid rgba(0,255,204,0.3); border-radius: 25px; cursor: pointer; transition: all 0.3s; }
        .day-btn.active { background: linear-gradient(45deg, #00ffcc, #0080ff); border-color: transparent; }
        .exercise-card { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s; }
        .exercise-card:hover { transform: translateX(10px); background: rgba(0,255,204,0.1); }
        .goal-selector { display: flex; gap: 30px; justify-content: center; margin: 40px 0; }
        .goal-card { padding: 40px; background: rgba(255,255,255,0.05); border: 2px solid transparent; border-radius: 20px; cursor: pointer; transition: all 0.3s; text-align: center; }
        .goal-card:hover { border-color: #00ffcc; transform: translateY(-5px); }
        .goal-card.selected { background: linear-gradient(45deg, #00ffcc, #0080ff); box-shadow: 0 10px 30px rgba(0,255,204,0.3); }
        @media (max-width: 768px) { .hero-title { font-size: 48px; } .section { padding: 50px 20px; } .scanner-container { grid-template-columns: 1fr; } }
        .float-animation { animation: float3d 6s ease-in-out infinite; }
        @keyframes float3d { 0%, 100% { transform: translateY(0) rotateX(0) rotateY(0); } 25% { transform: translateY(-20px) rotateX(5deg) rotateY(5deg); } 75% { transform: translateY(10px) rotateX(-5deg) rotateY(-5deg); } }
    </style>
    <!-- Latest Stable CDNs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r165/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.165.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
</head>
<body>
    <div id="loader">
        <div class="loader-content">
            <div class="loader-spinner"></div>
            <h2>Initializing 3D Experience...</h2>
        </div>
    </div>
    <nav id="navbar">
        <div class="nav-container">
            <div class="logo">FitLife AI</div>
            <ul class="nav-links">
                <li><a href="#hero">Home</a></li>
                <li><a href="#scanner">Scanner</a></li>
                <li><a href="#dashboard">Dashboard</a></li>
                <li><a href="#workout">Workout</a></li>
            </ul>
        </div>
    </nav>
    <section id="hero">
        <div id="canvas-container"></div>
        <div class="hero-content float-animation">
            <h1 class="hero-title">Transform Your Fitness</h1>
            <p class="hero-subtitle">AI-Powered Nutrition & Workout Planning</p>
            <a href="#scanner" class="cta-button">Get Started</a>
        </div>
    </section>
    <section class="section" id="goals">
        <h2 class="section-title">Choose Your Goal</h2>
        <div class="goal-selector">
            <div class="goal-card" data-goal="loss"><h3>Fat Loss</h3><p>Lose weight and get lean</p></div>
            <div class="goal-card" data-goal="gain"><h3>Muscle Gain</h3><p>Build strength and size</p></div>
        </div>
    </section>
    <section id="scanner" class="section">
        <h2 class="section-title float-animation">AI Food Scanner</h2>
        <div id="food-scanner">
            <div class="scanner-container">
                <div id="camera-feed">
                    <video id="video" autoplay></video>
                    <button class="scan-button" id="scan-btn">Scan Food</button>
                </div>
                <div class="nutrition-results">
                    <h3>Nutritional Information</h3>
                    <div class="nutrient-item"><span>Calories</span><span id="calories">--</span><div class="nutrient-bar"><div class="nutrient-fill" style="width: 0%"></div></div></div>
                    <div class="nutrient-item"><span>Protein</span><span id="protein">--g</span><div class="nutrient-bar"><div class="nutrient-fill" style="width: 0%"></div></div></div>
                    <div class="nutrient-item"><span>Carbs</span><span id="carbs">--g</span><div class="nutrient-bar"><div class="nutrient-fill" style="width: 0%"></div></div></div>
                    <div class="nutrient-item"><span>Fat</span><span id="fat">--g</span><div class="nutrient-bar"><div class="nutrient-fill" style="width: 0%"></div></div></div>
                </div>
            </div>
        </div>
    </section>
    <section id="dashboard" class="section">
        <h2 class="section-title float-animation">Your Progress</h2>
        <div class="dashboard-grid">
            <div class="stat-card"><h3>Today's Calories</h3><div class="stat-value">1,850</div><p>Target: 2,200 cal</p></div>
            <div class="stat-card"><h3>Weekly Average</h3><div class="stat-value">2,050</div><p>On Track</p></div>
            <div class="stat-card"><h3>Progress</h3><div class="stat-value">-3.2 lbs</div><p>This Week</p></div>
        </div>
    </section>
    <section id="workout" class="section">
        <h2 class="section-title float-animation">AI Workout Planner</h2>
        <div class="workout-planner">
            <div class="day-selector">
                <button class="day-btn active" data-day="chest">Chest Day</button>
                <button class="day-btn" data-day="back">Back Day</button>
                <button class="day-btn" data-day="legs">Leg Day</button>
                <button class="day-btn" data-day="shoulders">Shoulder Day</button>
                <button class="day-btn" data-day="arms">Arms Day</button>
            </div>
            <div id="workout-list"></div>
        </div>
    </section>
    <script>
        console.log('THREE.js Loaded'); // Debug log
        gsap.registerPlugin(ScrollTrigger);

        // Loading Screen
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').style.display = 'none', 1000);
            }, 2000);
        });

        // 3D Setup - Simplified
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Perf boost
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        console.log('Renderer attached'); // Debug

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0x00ffcc, 1, 100);
        pointLight.position.set(10, 10, 10);
        scene.add(pointLight);

        camera.position.z = 30;

        // Torus Knot - Main 3D Element
        const torusGeometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
        const torusMaterial = new THREE.MeshStandardMaterial({ color: 0x00ffcc, emissive: 0x004466, emissiveIntensity: 0.3 });
        const torusKnot = new THREE.Mesh(torusGeometry, torusMaterial);
        scene.add(torusKnot);
        console.log('Torus added');

        // Particles for Background
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 5000;
        const posArray = new Float32Array(particlesCount * 3);
        for (let i = 0; i < particlesCount * 3; i++) posArray[i] = (Math.random() - 0.5) * 200;
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({ size: 0.02, color: 0x00ffcc, transparent: true, opacity: 0.8 });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // Optional GLTF Loaders (no crash if missing)
        const gltfLoader = new THREE.GLTFLoader();
        let foodModel, workoutModel;
        try {
            gltfLoader.load('apple.gltf', (gltf) => {
                foodModel = gltf.scene;
                foodModel.scale.set(5, 5, 5);
                foodModel.position.set(20, 0, -50);
                foodModel.visible = false;
                scene.add(foodModel);
            });
            gltfLoader.load('dumbbell.gltf', (gltf) => {
                workoutModel = gltf.scene;
                workoutModel.scale.set(3, 3, 3);
                workoutModel.position.set(-20, 0, -50);
                workoutModel.visible = false;
                scene.add(workoutModel);
            });
        } catch (e) { console.log('Models optional, skipping:', e); }

        // Animation Loop
        function animate() {
            requestAnimationFrame(animate);
            torusKnot.rotation.x += 0.005;
            torusKnot.rotation.y += 0.01;
            particlesMesh.rotation.y += 0.0005;
            if (foodModel) foodModel.rotation.y += 0.01;
            if (workoutModel) workoutModel.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();
        console.log('Animation started');

        // GSAP Scrollytelling - Simple Timelines
        gsap.to(camera.position, {
            z: 10,
            scrollTrigger: { trigger: "#hero", start: "top top", end: "bottom top", scrub: 1 }
        });
        gsap.to(torusKnot.position, {
            y: -5,
            scrollTrigger: { trigger: "#scanner", start: "top center", end: "bottom center", scrub: 1,
                onEnter: () => { if (foodModel) { foodModel.visible = true; gsap.to(foodModel.position, { x: 0, z: -10, duration: 2 }); } }
            }
        });
        gsap.to(particlesMesh.position, {
            y: -10,
            scrollTrigger: { trigger: "#workout", start: "top center", end: "bottom center", scrub: 1,
                onEnter: () => { if (workoutModel) { workoutModel.visible = true; gsap.to(workoutModel.position, { x: 0, z: -10, duration: 2 }); } }
            }
        });

        // Navbar Scroll
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const navbar = document.getElementById('navbar');
            if (scrolled > 50) navbar.classList.add('scrolled');
            else navbar.classList.remove('scrolled');
        });

        // Goal Selection
        document.querySelectorAll('.goal-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.goal-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                generateWorkout();
            });
        });

        // Food Scanner
        navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
            document.getElementById('video').srcObject = stream;
        }).catch(err => console.log('Camera denied:', err));

        document.getElementById('scan-btn').addEventListener('click', () => {
            gsap.to('#camera-feed', { scale: 1.05, duration: 0.2, yoyo: true, repeat: 1 });
            setTimeout(() => {
                const calories = Math.floor(Math.random() * 300 + 200);
                const protein = Math.floor(Math.random() * 30 + 10);
                const carbs = Math.floor(Math.random() * 40 + 20);
                const fat = Math.floor(Math.random() * 20 + 5);
                document.getElementById('calories').textContent = calories + ' cal';
                document.getElementById('protein').textContent = protein + 'g';
                document.getElementById('carbs').textContent = carbs + 'g';
                document.getElementById('fat').textContent = fat + 'g';
                document.querySelectorAll('.nutrient-fill').forEach((fill, i) => {
                    gsap.to(fill, { width: (Math.random() * 80 + 20) + '%', duration: 1, delay: i * 0.2 });
                });
                if (foodModel) gsap.to(foodModel.scale, { x: 7, y: 7, z: 7, duration: 1, yoyo: true, repeat: 1 });
            }, 500);
        });

        // Workout Generator
        const workouts = {
            chest: ['Bench Press 4x8', 'Incline Dumbbell Press 3x10', 'Cable Flyes 3x12', 'Push-ups 3xFailure'],
            back: ['Deadlifts 4x6', 'Pull-ups 4x8', 'Barbell Rows 3x10', 'Lat Pulldowns 3x12'],
            legs: ['Squats 4x8', 'Leg Press 3x12', 'Lunges 3x10 each', 'Calf Raises 4x15'],
            shoulders: ['Military Press 4x8', 'Lateral Raises 3x12', 'Rear Delts 3x15', 'Shrugs 3x12'],
            arms: ['Barbell Curls 4x10', 'Tricep Dips 3x12', 'Hammer Curls 3x12', 'Cable Pushdowns 3x15']
        };
        document.querySelectorAll('.day-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const day = this.getAttribute('data-day');
                generateWorkout(day);
            });
        });
        function generateWorkout(day = 'chest') {
            const list = document.getElementById('workout-list');
            list.innerHTML = '';
            workouts[day].forEach((exercise, index) => {
                const card = document.createElement('div');
                card.className = 'exercise-card';
                card.innerHTML = `<span>${exercise}</span><span>‚è± Track</span>`;
                list.appendChild(card);
                gsap.from(card, { opacity: 0, x: -50, duration: 0.5, delay: index * 0.1 });
            });
            if (workoutModel) gsap.to(workoutModel.rotation, { y: '+=' + Math.PI * 2, duration: 2 });
        }
        generateWorkout();

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Section Reveals
        gsap.utils.toArray('.section').forEach(section => {
            gsap.from(section, { opacity: 0, y: 50, duration: 1, scrollTrigger: { trigger: section, start: "top 80%", toggleActions: "play none none reverse" } });
        });
    </script>
</body>
</html>
